import { THIS } from "../const/app.const";
export class Linq {
    static functionCreator(expression) {
        var functionSetter = [];
        var match = expression.match(/^\s*\(?\s*([^)]*)\s*\)?\s*=>(.*)/);
        var splitSelect = match[2].split(",");
        for (var i = 0; i < splitSelect.length; i++) {
            var equalToOperator = splitSelect[i].match(/^\s*\(?\s*([^)]*)\s*\)?\s*|===|!==|==|!=|>=|>|<=|<|(.*)/);
            if (equalToOperator !== null) {
                functionSetter = new Function(match[1], "return " + equalToOperator.input);
            }
            else {
                equalToOperator = splitSelect[i].match(/^\s*\(?\s*([^)]*)\s*\)?\s*=(.*)/);
                if (equalToOperator === null) {
                    functionSetter = new Function(match[1], "return " + splitSelect.input);
                }
                else {
                    functionSetter = new Function(match[1], "return " + equalToOperator.input);
                }
            }
        }
        if (splitSelect.length == 0)
            functionSetter = { accessFunction: new Function(match[1], "return " + match[2]) };
        return functionSetter;
    }
    static execute(jObject, config, parentObject, modelInstance, isDynamicConfig) {
        let expressionFunction = isDynamicConfig ? config.dynamicConfig : config.conditionalExpression;
        let lastParam = isDynamicConfig ? config : modelInstance;
        if (parentObject && typeof expressionFunction == "string")
            expressionFunction = Linq.functionCreator(expressionFunction);
        if (parentObject && expressionFunction)
            return modelInstance && modelInstance.constructor !== Object ? expressionFunction.call(modelInstance, parentObject, jObject, lastParam) : expressionFunction(parentObject, jObject, lastParam);
        return true;
    }
    static getConditionPath(texts) {
        let path = "";
        for (var i = 1; i < texts.length; i++)
            path += (texts.length - 1) == i ? texts[i].trim() : `${texts[i].trim()}.`;
        return path;
    }
    static expressionParser(expression, isNonValidationExpression) {
        let splitExpressions = [];
        let columns = [];
        let expressionString = expression.toString();
        let expressionArguments = Linq.extractArguments(expressionString.match(/\(([^)]+)\)/g));
        if (expressionArguments.length > 0) {
            let splitTexts = [];
            expressionString.replace(/\s/g, '').replace(new RegExp(/{|}/, "g"), "").split(new RegExp(/return|===|!==|==|!=|>=|>|<=|<|&&/)).forEach(t => {
                let texts = t.replace(/\(|\)/g, "").split("||");
                for (let text of texts)
                    splitTexts.push(text);
            });
            splitTexts.forEach(t => {
                expressionArguments.forEach((x, i) => {
                    t = t.trim();
                    if (t.startsWith(x + '.')) {
                        var splitText = t.split('.');
                        if (splitText.length == 2 || (splitText.length >= 2 && isNonValidationExpression))
                            if (!isNonValidationExpression)
                                columns.push({ propName: splitText[1].trim(), argumentIndex: i == 3 ? 0 : i == 2 ? 1 : i == 1 ? -1 : i });
                            else
                                columns.push({ propName: this.getConditionPath(splitText), argumentIndex: i == 3 ? 0 : i == 2 ? 1 : i == 1 ? -1 : i });
                        else {
                            var arrayProp = splitText[1].split('[');
                            let jObject = {
                                propName: splitText[splitText.length - 1].trim(),
                                objectPropName: arrayProp[0],
                                arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined,
                                argumentIndex: i === 3 ? 0 : i === 2 ? 1 : i
                            };
                            columns.push(jObject);
                        }
                    }
                });
            });
        }
        return columns;
    }
    static extractArguments(splitTexts) {
        let expressionArguments = [THIS];
        if (splitTexts && splitTexts[0])
            splitTexts[0].split(",").forEach(t => expressionArguments.push(t.trim().replace("(", "").replace(")", "")));
        return expressionArguments;
    }
    static expressionColumns(expression, isNonValidationExpression = false) {
        var columns = [];
        let splitExpressions = [];
        if (typeof expression == "string") {
            expression.split("=>")[1].split(" && ").forEach(t => {
                t.split(" || ").forEach(x => {
                    splitExpressions.push(x.trim().split(' ')[0]);
                });
            });
            splitExpressions.forEach(t => {
                var splitText = t.split('.');
                if (splitText.length == 2)
                    columns.push({ propName: splitText[1].trim() });
                else {
                    var arrayProp = splitText[1].split('[');
                    let jObject = {
                        propName: splitText[splitText.length - 1].trim(),
                        objectPropName: arrayProp[0],
                        arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined
                    };
                    columns.push(jObject);
                }
            });
        }
        else {
            columns = Linq.expressionParser(expression, isNonValidationExpression);
        }
        return columns;
    }
    static dynamicConfigParser(expression, propName) {
        let controlNames = [];
        let expressionString = expression.toString();
        let expressionArguments = Linq.extractArguments(expressionString.match(/\(([^)]+)\)/g));
        let splitString = expressionString.replace(new RegExp(/\r?\n|\r|;/g), ' ').replace(/["%()\{}=\\?ï¿½`'#<>|,;:+-]+/g, " ").split(/ /g);
        if (expressionArguments.length > 3)
            expressionArguments.splice(expressionArguments.length - 1, 1);
        expressionArguments.forEach(t => {
            splitString.filter(x => x != `${t}.${propName}` && x.startsWith(`${t}.`)).forEach(x => {
                let split = x.split('.');
                if (split.length == 2)
                    controlNames.push({ propName: x.replace(`${t}.`, '') });
                else {
                    var arrayProp = split[1].split('[');
                    let jObject = {
                        propName: split[split.length - 1].trim(),
                        objectPropName: arrayProp[0],
                        arrayIndex: arrayProp.length > 1 ? arrayProp[1].replace("]", "") : undefined,
                    };
                    controlNames.push(jObject);
                }
            });
        });
        return controlNames;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlucS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0ByeHdlYi9yZWFjdGl2ZS1mb3JtLXZhbGlkYXRvcnMvIiwic291cmNlcyI6WyJ1dGlsL2xpbnEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ3pDLE1BQU0sT0FBTyxJQUFJO0lBQ2IsTUFBTSxDQUFDLGVBQWUsQ0FBQyxVQUFVO1FBQzdCLElBQUksY0FBYyxHQUFRLEVBQUUsQ0FBQztRQUM3QixJQUFJLEtBQUssR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDakUsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN6QyxJQUFJLGVBQWUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLHlEQUF5RCxDQUFDLENBQUM7WUFDdEcsSUFBSSxlQUFlLEtBQUssSUFBSSxFQUFFO2dCQUMxQixjQUFjLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDOUU7aUJBQU07Z0JBQ0gsZUFBZSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztnQkFDMUUsSUFBSSxlQUFlLEtBQUssSUFBSSxFQUFFO29CQUMxQixjQUFjLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQzFFO3FCQUFNO29CQUNILGNBQWMsR0FBRyxJQUFJ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QUM7UUFDSCxPQUFPLFlBQVksQ0FBQztJQUN4QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUSElTIH0gZnJvbSBcIi4uL2NvbnN0L2FwcC5jb25zdFwiXHJcbmV4cG9ydCBjbGFzcyBMaW5xIHtcclxuICAgIHN0YXRpYyBmdW5jdGlvbkNyZWF0b3IoZXhwcmVzc2lvbik6IGFueSB7XHJcbiAgICAgICAgdmFyIGZ1bmN0aW9uU2V0dGVyOiBhbnkgPSBbXTtcclxuICAgICAgICB2YXIgbWF0Y2ggPSBleHByZXNzaW9uLm1hdGNoKC9eXFxzKlxcKD9cXHMqKFteKV0qKVxccypcXCk/XFxzKj0+KC4qKS8pO1xyXG4gICAgICAgIHZhciBzcGxpdFNlbGVjdCA9IG1hdGNoWzJdLnNwbGl0KFwiLFwiKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwbGl0U2VsZWN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBlcXVhbFRvT3BlcmF0b3IgPSBzcGxpdFNlbGVjdFtpXS5tYXRjaCgvXlxccypcXCg/XFxzKihbXildKilcXHMqXFwpP1xccyp8PT09fCE9PXw9PXwhPXw+PXw+fDw9fDx8KC4qKS8pO1xyXG4gICAgICAgICAgICBpZiAoZXF1YWxUb09wZXJhdG9yICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBlcXVhbFRvT3BlcmF0b3IuaW5wdXQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZXF1YWxUb09wZXJhdG9yID0gc3BsaXRTZWxlY3RbaV0ubWF0Y2goL15cXHMqXFwoP1xccyooW14pXSopXFxzKlxcKT9cXHMqPSguKikvKTtcclxuICAgICAgICAgICAgICAgIGlmIChlcXVhbFRvT3BlcmF0b3IgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBzcGxpdFNlbGVjdC5pbnB1dCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uU2V0dGVyID0gbmV3IEZ1bmN0aW9uKG1hdGNoWzFdLCBcInJldHVybiBcIiArIGVxdWFsVG9PcGVyYXRvci5pbnB1dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNwbGl0U2VsZWN0Lmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICBmdW5jdGlvblNldHRlciA9IHsgYWNjZXNzRnVuY3Rpb246IG5ldyBGdW5jdGlvbihtYXRjaFsxXSwgXCJyZXR1cm4gXCIgKyBtYXRjaFsyXSkgfTtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb25TZXR0ZXI7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZXhlY3V0ZShqT2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBjb25maWc6IGFueSwgcGFyZW50T2JqZWN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBtb2RlbEluc3RhbmNlOiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBpc0R5bmFtaWNDb25maWc6IGJvb2xlYW4pOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgZXhwcmVzc2lvbkZ1bmN0aW9uOiBGdW5jdGlvbiB8IHN0cmluZyA9IGlzRHluYW1pY0NvbmZpZyA/IGNvbmZpZy5keW5hbWljQ29uZmlnIDogY29uZmlnLmNvbmRpdGlvbmFsRXhwcmVzc2lvbjtcclxuICAgICAgICBsZXQgbGFzdFBhcmFtID0gaXNEeW5hbWljQ29uZmlnID8gY29uZmlnIDogbW9kZWxJbnN0YW5jZTtcclxuICAgICAgICBpZiAocGFyZW50T2JqZWN0ICYmIHR5cGVvZiBleHByZXNzaW9uRnVuY3Rpb24gPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgZXhwcmVzc2lvbkZ1bmN0aW9uID0gTGlucS5mdW5jdGlvbkNyZWF0b3IoZXhwcmVzc2lvbkZ1bmN0aW9uKTtcclxuICAgICAgICBpZiAocGFyZW50T2JqZWN0ICYmIGV4cHJlc3Npb25GdW5jdGlvbilcclxuICAgICAgICAgICAgcmV0dXJuIG1vZGVsSW5zdGFuY2UgJiYgbW9kZWxJbnN0YW5jZS5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0ID8gKDxGdW5jdGlvbj5leHByZXNzaW9uRnVuY3Rpb24pLmNhbGwobW9kZWxJbnN0YW5jZSwgcGFyZW50T2JqZWN0LCBqT2JqZWN0LCBsYXN0UGFyYW0pIDogKDxGdW5jdGlvbj5leHByZXNzaW9uRnVuY3Rpb24pKHBhcmVudE9iamVjdCwgak9iamVjdCwgbGFzdFBhcmFtKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBnZXRDb25kaXRpb25QYXRoKHRleHRzOiBzdHJpbmdbXSk6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IHBhdGggPSBcIlwiO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGV4dHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHBhdGggKz0gKHRleHRzLmxlbmd0aCAtIDEpID09IGkgPyB0ZXh0c1tpXS50cmltKCkgOiBgJHt0ZXh0c1tpXS50cmltKCl9LmBcclxuICAgICAgICByZXR1cm4gcGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBleHByZXNzaW9uUGFyc2VyKGV4cHJlc3Npb246IGFueSwgaXNOb25WYWxpZGF0aW9uRXhwcmVzc2lvbjogYm9vbGVhbikge1xyXG4gICAgICAgIGxldCBzcGxpdEV4cHJlc3Npb25zID0gW107XHJcbiAgICAgICAgbGV0IGNvbHVtbnMgPSBbXTtcclxuICAgICAgICBsZXQgZXhwcmVzc2lvblN0cmluZyA9IGV4cHJlc3Npb24udG9TdHJpbmcoKTtcclxuICAgICAgICBsZXQgZXhwcmVzc2lvbkFyZ3VtZW50cyA9IExpbnEuZXh0cmFjdEFyZ3VtZW50cyhleHByZXNzaW9uU3RyaW5nLm1hdGNoKC9cXCgoW14pXSspXFwpL2cpKTtcclxuICAgICAgICBpZiAoZXhwcmVzc2lvbkFyZ3VtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGxldCBzcGxpdFRleHRzID0gW107XHJcbiAgICAgICAgICAgIGV4cHJlc3Npb25TdHJpbmcucmVwbGFjZSgvXFxzL2csICcnKS5yZXBsYWNlKG5ldyBSZWdFeHAoL3t8fS8sIFwiZ1wiKSwgXCJcIikuc3BsaXQobmV3IFJlZ0V4cCgvcmV0dXJufD09PXwhPT18PT18IT18Pj18Pnw8PXw8fCYmLykpLmZvckVhY2godCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGV4dHMgPSB0LnJlcGxhY2UoL1xcKHxcXCkvZywgXCJcIikuc3BsaXQoXCJ8fFwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IHRleHQgb2YgdGV4dHMpXHJcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRUZXh0cy5wdXNoKHRleHQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3BsaXRUZXh0cy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbkFyZ3VtZW50cy5mb3JFYWNoKCh4LCBpKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdCA9IHQudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0LnN0YXJ0c1dpdGgoeCArICcuJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwbGl0VGV4dCA9IHQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0VGV4dC5sZW5ndGggPT0gMiB8fCAoc3BsaXRUZXh0Lmxlbmd0aCA+PSAyICYmIGlzTm9uVmFsaWRhdGlvbkV4cHJlc3Npb24pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05vblZhbGlkYXRpb25FeHByZXNzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnMucHVzaCh7IHByb3BOYW1lOiBzcGxpdFRleHRbMV0udHJpbSgpLCBhcmd1bWVudEluZGV4OiBpID09IDMgPyAwIDogaSA9PSAyID8gMSA6IGkgPT0gMSA/IC0xIDogaSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goeyBwcm9wTmFtZTogdGhpcy5nZXRDb25kaXRpb25QYXRoKHNwbGl0VGV4dCksIGFyZ3VtZW50SW5kZXg6IGkgPT0gMyA/IDAgOiBpID09IDIgPyAxIDogaSA9PSAxID8gLTEgOiBpIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcnJheVByb3AgPSBzcGxpdFRleHRbMV0uc3BsaXQoJ1snKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBqT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BOYW1lOiBzcGxpdFRleHRbc3BsaXRUZXh0Lmxlbmd0aCAtIDFdLnRyaW0oKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RQcm9wTmFtZTogYXJyYXlQcm9wWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5SW5kZXg6IGFycmF5UHJvcC5sZW5ndGggPiAxID8gYXJyYXlQcm9wWzFdLnJlcGxhY2UoXCJdXCIsIFwiXCIpIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50SW5kZXg6IGkgPT09IDMgPyAwIDogaSA9PT0gMiA/IDEgOiBpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goak9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29sdW1ucztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBleHRyYWN0QXJndW1lbnRzKHNwbGl0VGV4dHM6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGxldCBleHByZXNzaW9uQXJndW1lbnRzOiBzdHJpbmdbXSA9IFtUSElTXTtcclxuICAgICAgICBpZiAoc3BsaXRUZXh0cyAmJiBzcGxpdFRleHRzWzBdKVxyXG4gICAgICAgICAgICBzcGxpdFRleHRzWzBdLnNwbGl0KFwiLFwiKS5mb3JFYWNoKHQgPT4gZXhwcmVzc2lvbkFyZ3VtZW50cy5wdXNoKHQudHJpbSgpLnJlcGxhY2UoXCIoXCIsIFwiXCIpLnJlcGxhY2UoXCIpXCIsIFwiXCIpKSk7XHJcbiAgICAgICAgcmV0dXJuIGV4cHJlc3Npb25Bcmd1bWVudHM7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGV4cHJlc3Npb25Db2x1bW5zKGV4cHJlc3Npb246IGFueSwgaXNOb25WYWxpZGF0aW9uRXhwcmVzc2lvbjogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgdmFyIGNvbHVtbnMgPSBbXTtcclxuICAgICAgICBsZXQgc3BsaXRFeHByZXNzaW9ucyA9IFtdO1xyXG4gICAgICAgIGlmICh0eXBlb2YgZXhwcmVzc2lvbiA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGV4cHJlc3Npb24uc3BsaXQoXCI9PlwiKVsxXS5zcGxpdChcIiAmJiBcIikuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgICAgIHQuc3BsaXQoXCIgfHwgXCIpLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3BsaXRFeHByZXNzaW9ucy5wdXNoKHgudHJpbSgpLnNwbGl0KCcgJylbMF0pXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3BsaXRFeHByZXNzaW9ucy5mb3JFYWNoKHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwbGl0VGV4dCA9IHQuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIGlmIChzcGxpdFRleHQubGVuZ3RoID09IDIpXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKHsgcHJvcE5hbWU6IHNwbGl0VGV4dFsxXS50cmltKCkgfSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXJyYXlQcm9wID0gc3BsaXRUZXh0WzFdLnNwbGl0KCdbJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGpPYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BOYW1lOiBzcGxpdFRleHRbc3BsaXRUZXh0Lmxlbmd0aCAtIDFdLnRyaW0oKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0UHJvcE5hbWU6IGFycmF5UHJvcFswXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlJbmRleDogYXJyYXlQcm9wLmxlbmd0aCA+IDEgPyBhcnJheVByb3BbMV0ucmVwbGFjZShcIl1cIiwgXCJcIikgOiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKGpPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29sdW1ucyA9IExpbnEuZXhwcmVzc2lvblBhcnNlcihleHByZXNzaW9uLCBpc05vblZhbGlkYXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbHVtbnM7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGR5bmFtaWNDb25maWdQYXJzZXIoZXhwcmVzc2lvbjogRnVuY3Rpb24sIHByb3BOYW1lOiBzdHJpbmcpOiBhbnlbXSB7XHJcbiAgICAgICAgbGV0IGNvbnRyb2xOYW1lcyA9IFtdO1xyXG4gICAgICAgIGxldCBleHByZXNzaW9uU3RyaW5nID0gZXhwcmVzc2lvbi50b1N0cmluZygpO1xyXG4gICAgICAgIGxldCBleHByZXNzaW9uQXJndW1lbnRzID0gTGlucS5leHRyYWN0QXJndW1lbnRzKGV4cHJlc3Npb25TdHJpbmcubWF0Y2goL1xcKChbXildKylcXCkvZykpO1xyXG4gICAgICAgIGxldCBzcGxpdFN0cmluZzogc3RyaW5nW10gPSBleHByZXNzaW9uU3RyaW5nLnJlcGxhY2UobmV3IFJlZ0V4cCgvXFxyP1xcbnxcXHJ8Oy9nKSwgJyAnKS5yZXBsYWNlKC9bXCIlKClcXHt9PVxcXFw/77+9YCcjPD58LDs6Ky1dKy9nLCBcIiBcIikuc3BsaXQoLyAvZyk7XHJcbiAgICAgICAgaWYgKGV4cHJlc3Npb25Bcmd1bWVudHMubGVuZ3RoID4gMylcclxuICAgICAgICAgICAgZXhwcmVzc2lvbkFyZ3VtZW50cy5zcGxpY2UoZXhwcmVzc2lvbkFyZ3VtZW50cy5sZW5ndGggLSAxLCAxKVxyXG4gICAgICAgIGV4cHJlc3Npb25Bcmd1bWVudHMuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgc3BsaXRTdHJpbmcuZmlsdGVyKHggPT4geCAhPSBgJHt0fS4ke3Byb3BOYW1lfWAgJiYgeC5zdGFydHNXaXRoKGAke3R9LmApKS5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHNwbGl0ID0geC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNwbGl0Lmxlbmd0aCA9PSAyKVxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xOYW1lcy5wdXNoKHsgcHJvcE5hbWU6IHgucmVwbGFjZShgJHt0fS5gLCAnJykgfSlcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnJheVByb3AgPSBzcGxpdFsxXS5zcGxpdCgnWycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBqT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wTmFtZTogc3BsaXRbc3BsaXQubGVuZ3RoIC0gMV0udHJpbSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RQcm9wTmFtZTogYXJyYXlQcm9wWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheUluZGV4OiBhcnJheVByb3AubGVuZ3RoID4gMSA/IGFycmF5UHJvcFsxXS5yZXBsYWNlKFwiXVwiLCBcIlwiKSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbE5hbWVzLnB1c2goak9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBjb250cm9sTmFtZXM7XHJcbiAgICB9XHJcbn1cclxuIl19